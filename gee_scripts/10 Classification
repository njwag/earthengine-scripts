/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var urban = 
    /* color: #98ff00 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.42561747950417, 29.8344681467275],
                  [-95.42561747950417, 29.831340978045837],
                  [-95.42166926783425, 29.831340978045837],
                  [-95.42166926783425, 29.8344681467275]]], null, false),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.53548076075417, 29.844146857969648],
                  [-95.53548076075417, 29.838786456845472],
                  [-95.53084590357643, 29.838786456845472],
                  [-95.53084590357643, 29.844146857969648]]], null, false),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.39609172266823, 29.802447268178348],
                  [-95.39609172266823, 29.7976804932212],
                  [-95.39094188135964, 29.7976804932212],
                  [-95.39094188135964, 29.802447268178348]]], null, false),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.44312693995339, 29.7961908294706],
                  [-95.44312693995339, 29.792764518679355],
                  [-95.43969371241432, 29.792764518679355],
                  [-95.43969371241432, 29.7961908294706]]], null, false),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.32605388087136, 29.7990211716339],
                  [-95.32605388087136, 29.79589289405908],
                  [-95.32159068507057, 29.79589289405908],
                  [-95.32159068507057, 29.7990211716339]]], null, false),
            {
              "landcover": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.56861140650612, 29.797531527844182],
                  [-95.56861140650612, 29.79231759992709],
                  [-95.56483485621315, 29.79231759992709],
                  [-95.56483485621315, 29.797531527844182]]], null, false),
            {
              "landcover": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.3603003255735, 29.761549896535158],
                  [-95.3603003255735, 29.75782435153478],
                  [-95.35609462183815, 29.75782435153478],
                  [-95.35609462183815, 29.761549896535158]]], null, false),
            {
              "landcover": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.37806727808815, 29.74612524003341],
                  [-95.37806727808815, 29.742697216257298],
                  [-95.37437655848366, 29.742697216257298],
                  [-95.37437655848366, 29.74612524003341]]], null, false),
            {
              "landcover": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.39900996607643, 29.745529070404185],
                  [-95.39900996607643, 29.742995309933725],
                  [-95.39566256922585, 29.742995309933725],
                  [-95.39566256922585, 29.745529070404185]]], null, false),
            {
              "landcover": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.31154849451882, 29.750819951984028],
                  [-95.31154849451882, 29.74709400812038],
                  [-95.30768611353737, 29.74709400812038],
                  [-95.30768611353737, 29.750819951984028]]], null, false),
            {
              "landcover": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.51724926211652, 29.714562776872857],
                  [-95.51724926211652, 29.71009001145039],
                  [-95.5129577276927, 29.71009001145039],
                  [-95.5129577276927, 29.714562776872857]]], null, false),
            {
              "landcover": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.43794170596418, 29.711879141530417],
                  [-95.43794170596418, 29.70800265273096],
                  [-95.4305602667552, 29.70800265273096],
                  [-95.4305602667552, 29.711879141530417]]], null, false),
            {
              "landcover": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.45347706057844, 29.70174031623799],
                  [-95.45347706057844, 29.69778887921067],
                  [-95.45124546267805, 29.69778887921067],
                  [-95.45124546267805, 29.70174031623799]]], null, false),
            {
              "landcover": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.44909969546613, 29.701516654141376],
                  [-95.44909969546613, 29.698459888907475],
                  [-95.4473830816966, 29.698459888907475],
                  [-95.4473830816966, 29.701516654141376]]], null, false),
            {
              "landcover": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.26078308905949, 29.65047164484916],
                  [-95.26078308905949, 29.644429513656448],
                  [-95.25503243293156, 29.644429513656448],
                  [-95.25503243293156, 29.65047164484916]]], null, false),
            {
              "landcover": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.24559105719914, 29.650620828685707],
                  [-95.24559105719914, 29.6461452174068],
                  [-95.24258698310246, 29.6461452174068],
                  [-95.24258698310246, 29.650620828685707]]], null, false),
            {
              "landcover": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.40752362597671, 29.635036070838897],
                  [-95.40752362597671, 29.63100740613401],
                  [-95.40237378466811, 29.63100740613401],
                  [-95.40237378466811, 29.635036070838897]]], null, false),
            {
              "landcover": 0,
              "system:index": "16"
            })]),
    water = 
    /* color: #0b4a8b */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-94.87881170663967, 29.622644895178524],
                  [-94.87881170663967, 29.57308996262558],
                  [-94.8094605103506, 29.57308996262558],
                  [-94.8094605103506, 29.622644895178524]]], null, false),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-94.85752569589748, 29.454178472578803],
                  [-94.85752569589748, 29.43384797082589],
                  [-94.83486639413967, 29.43384797082589],
                  [-94.83486639413967, 29.454178472578803]]], null, false),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.27634369005985, 29.72940895930301],
                  [-95.27634369005985, 29.727806478331896],
                  [-95.2753995524866, 29.727806478331896],
                  [-95.2753995524866, 29.72940895930301]]], null, false),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.30535446276492, 29.72443373127675],
                  [-95.30535446276492, 29.72365108868373],
                  [-95.3050969706995, 29.72365108868373],
                  [-95.3050969706995, 29.72443373127675]]], null, false),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.03813921341548, 29.735493315411052],
                  [-95.03813921341548, 29.7305742885222],
                  [-95.0340193403686, 29.7305742885222],
                  [-95.0340193403686, 29.735493315411052]]], null, false),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.39587720556752, 29.762971601814762],
                  [-95.39587720556752, 29.7628318983592],
                  [-95.39541586561695, 29.7628318983592],
                  [-95.39541586561695, 29.762971601814762]]], null, false),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.401906811433, 29.76201230082981],
                  [-95.401906811433, 29.761872596036717],
                  [-95.40109141989247, 29.761872596036717],
                  [-95.40109141989247, 29.76201230082981]]], null, false),
            {
              "landcover": 1,
              "system:index": "6"
            })]),
    forest = 
    /* color: #ffc82d */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.60584795591977, 29.813738929884497],
                  [-95.60584795591977, 29.80301457755007],
                  [-95.59692156431821, 29.80301457755007],
                  [-95.59692156431821, 29.813738929884497]]], null, false),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.66644442198422, 29.80495100401609],
                  [-95.66644442198422, 29.79646024059828],
                  [-95.65545809385922, 29.79646024059828],
                  [-95.65545809385922, 29.80495100401609]]], null, false),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.66283953306821, 29.764576207594864],
                  [-95.66283953306821, 29.75116400245364],
                  [-95.65683138487485, 29.75116400245364],
                  [-95.65683138487485, 29.764576207594864]]], null, false),
            {
              "landcover": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.24596967015111, 29.86928784346377],
                  [-95.24596967015111, 29.860802546068534],
                  [-95.23635663304174, 29.860802546068534],
                  [-95.23635663304174, 29.86928784346377]]], null, false),
            {
              "landcover": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.2339533737644, 29.875837404065837],
                  [-95.2339533737644, 29.86913898481596],
                  [-95.23034848484838, 29.86913898481596],
                  [-95.23034848484838, 29.875837404065837]]], null, false),
            {
              "landcover": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.45380868229711, 30.003950942663675],
                  [-95.45380868229711, 30.000048614581203],
                  [-95.45071877751195, 30.000048614581203],
                  [-95.45071877751195, 30.003950942663675]]], null, false),
            {
              "landcover": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.30388226239182, 30.066999948599854],
                  [-95.30388226239182, 30.043524267799935],
                  [-95.28568615643479, 30.043524267799935],
                  [-95.28568615643479, 30.066999948599854]]], null, false),
            {
              "landcover": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.43738448378107, 29.647739437843022],
                  [-95.43738448378107, 29.643935072047174],
                  [-95.43369376417658, 29.643935072047174],
                  [-95.43369376417658, 29.647739437843022]]], null, false),
            {
              "landcover": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.37859046217463, 29.66444710653124],
                  [-95.37859046217463, 29.659524599558182],
                  [-95.37266814466975, 29.659524599558182],
                  [-95.37266814466975, 29.66444710653124]]], null, false),
            {
              "landcover": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.48115813490412, 29.570057151006264],
                  [-95.48115813490412, 29.559605401040372],
                  [-95.47085845228693, 29.559605401040372],
                  [-95.47085845228693, 29.570057151006264]]], null, false),
            {
              "landcover": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.45137488600275, 29.775139788243987],
                  [-95.45137488600275, 29.771787258805244],
                  [-95.44751250502131, 29.771787258805244],
                  [-95.44751250502131, 29.775139788243987]]], null, false),
            {
              "landcover": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-95.44571022280626, 29.761317856748633],
                  [-95.44571022280626, 29.75640009670807],
                  [-95.44227699526719, 29.75640009670807],
                  [-95.44227699526719, 29.761317856748633]]], null, false),
            {
              "landcover": 2,
              "system:index": "11"
            })]),
    aoi = 
    /* color: #00ffff */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-96.17944901329186, 30.185028455024188],
          [-96.17944901329186, 29.086904091853192],
          [-94.30628006797936, 29.086904091853192],
          [-94.30628006797936, 30.185028455024188]]], null, false);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
Map.centerObject(aoi,9);

// Load the Landsat 8 scaled radiance image collection.
var landsatCollection = ee.ImageCollection('LANDSAT/LC08/C01/T1')
    .filterBounds(aoi)
    .filterDate('2017-01-01', '2017-12-31');

/* GEE provides the function ee.Algorithms.Landsat.simpleComposite() which can be applied to Landsat 
image collections to create a cloud free composite in a fast and convenient matter.*/
var composite = ee.Algorithms.Landsat.simpleComposite({
  collection: landsatCollection,
  asFloat: true
});

composite = composite.clip(aoi)

// Visualize the Composite
var viz = {
  max: 0.5,
  bands: ['B4', 'B3', 'B2'], 
  gamma: 2
};

Map.addLayer(composite, viz, 'L8 Image', false);

var newfc = urban.merge(water).merge(forest);

print(newfc, 'newfc');

// Select the bands for training
var bands = ['B2', 'B3', 'B4', 'B5', 'B6', 'B7','B8'];

// Sample the input imagery to get a FeatureCollection of training data.
var training = composite.select(bands).sampleRegions({
  collection: newfc,
  properties: ['landcover'],
  scale: 30
});

// Make a Random Forest classifier and train it. Using 10 trees.
var classifier = ee.Classifier.smileRandomForest(10).train({
  features: training,
  classProperty: 'landcover',
  inputProperties: bands
});

// Classify the input imagery.
var classified = composite.select(bands).classify(classifier);

// Define a palette for the Land Use classification.
var palette = [
  'D3D3D3', // urban (0)  // grey
  '0000FF', // water (1)  // blue
  '008000' //  forest (2) // green
];

// Display the classification result and the input image.
Map.addLayer(classified, {min: 0, max: 2, palette: palette}, 'Land Use Classification');

// Get a confusion matrix representing resubstitution accuracy.
print('RF error matrix: ', classifier.confusionMatrix());
print('RF accuracy: ', classifier.confusionMatrix().accuracy());